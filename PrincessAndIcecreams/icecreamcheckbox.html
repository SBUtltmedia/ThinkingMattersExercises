<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ice Cream Flavor Selector</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        .flavor-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        .flavor-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 5px;
            border: 1px solid #eee;
            transition: background-color 0.1s ease;
        }
        .flavor-item:hover {
            background-color: #f8f8f8;
        }
    </style>
</head>
<body>


    <h1>Ice Cream Flavor Selector</h1>
    <p>Click or drag to select/unselect multiple flavors. Drag in any direction to toggle items.</p>
    <div id="flavorContainer" class="flavor-list"></div>

    <div style="margin-top: 20px;">
        <button onclick="logSelectedFlavors()">Log Selected Flavors</button>
    </div>

    <script>
        class SVGCheckbox extends HTMLElement {
    constructor() {
        super();
        this.attachShadow({ mode: 'open' });
        this._visitedDuringDrag = false;
        this.checkedState = false;

        this.allFlavors = [
            ["Almond", "#D2B48C"], 
            ["Bastani Sonnati (Persian)", "#FFD700"],
            ["Butter Pecan", "#FFF5E1"],
            ["Cayenne Chocolate", "#5C4033"],
            ["Chocolate Chip Cookie Dough", "#EED9C4"],
            ["Coconut Almond Chip", "#FFFFFF"],
            ["Dulce de Leche", "#C19A6B"],
            ["English Toffee", "#8B4513"],
            ["Goat Cheese Beet Swirl", "#FFFFFF"],
            ["Green Tea Ice Cream", "#98FB98"],
            ["Honey Avocado", "#FFC30B"],
            ["Honeyjack and Coke", "#654321"],
            ["Huckleberry", "#800080"],
            ["Jalapeño", "#008000"],
            ["Lavender Honey", "#D8BFD8"],
            ["Les Bourgeois and Ghirardelli", "#4B382A"],
            ["Madagascar Vanilla", "#FAEBD7"],
            ["Mango", "#FFA500"],
            ["Mint Chocolate Chip", "#98FB98"],
            ["Moose Tracks", "#EED9C4"],
            ["Passion Fruit", "#FF7518"],
            ["Pistachio", "#A7C796"],
            ["Peanut Butter", "#D2B48C"],
            ["Pralines and Cream", "#FFF5E1"],
            ["Red Velvet", "#C71585"],
            ["Rum Raisin", "#FFF5E1"],
            ["Spumoni", "#008000"],
            ["Strawberry", "#FFC0CB"],
            ["Sweet Potato Maple Walnut", "#D2691E"],
            ["Ube (Philippines, Purple Yam)", "#6A0DAD"],
            ["Vietnamese Coffee", "#D2B48C"]
        ];

    }

    async connectedCallback() {
        this.render();
        await this.loadSVG();
        this.setupEventListeners();
    }

    render() {
        const container = document.createElement('div');
        container.setAttribute('class', 'svg-checkbox-container');

        this.nativeCheckbox = document.createElement('input');
        this.nativeCheckbox.type = 'checkbox';
        this.nativeCheckbox.style.display = 'none';

        container.appendChild(this.nativeCheckbox);

        const style = document.createElement('style');
        style.textContent = `
            .svg-checkbox-container {
                display: inline-block;
                cursor: pointer;
                user-select: none;
                position: relative;
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
            }
            .svg-container {
                width: 50px;
                height: 50px;
                transition: transform 1s ease-in-out;
                filter: grayscale(100%); /* Default grayscale */
            }
            :host([checked]) .svg-container {
                transform: scale(1.3);
                filter: none; /* Remove grayscale when selected */
                animation: wiggle 0.2s ease-in-out 2;
            }
            @keyframes wiggle {
                0% { transform: scale(1.3) rotate(0deg); }
                25% { transform: scale(1.3) rotate(5deg); }
                50% { transform: scale(1.3) rotate(-5deg); }
                75% { transform: scale(1.3) rotate(3deg); }
                100% { transform: scale(1.3) rotate(0deg); }
            }
        `;

        this.shadowRoot.appendChild(style);
        this.shadowRoot.appendChild(container);
    }

    async loadSVG() {
        const svgContainer = document.createElement('div');
        svgContainer.setAttribute('class', 'svg-container');

        try {
            const response = await fetch('icecream.svg');  // Ensure this file exists
            if (!response.ok) throw new Error("Failed to load SVG");

            let svgData = await response.text();
            svgContainer.innerHTML = svgData;

            // Apply initial color
            this.applyFlavorColor(svgContainer);
        } catch (error) {
            console.error("Error loading SVG:", error);
            svgContainer.innerHTML = `<p>SVG Load Error</p>`;
        }

        this.shadowRoot.querySelector('.svg-checkbox-container').appendChild(svgContainer);
    }

    createSVGCheckbox() {
        const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        svg.setAttribute('class', 'svg-checkbox');
        svg.setAttribute('width', '24');
        svg.setAttribute('height', '24');
        svg.setAttribute('viewBox', '0 0 24 24');

        const box = document.createElementNS('http://www.w3.org/2000/svg', 'use');
        box.setAttribute('x', '2');
        box.setAttribute('y', '2');
        box.setAttribute('width', '20');
        box.setAttribute('height', '20');
        box.setAttribute('rx', '3');
        box.setAttribute('ry', '3');
        box.setAttribute('fill', 'none');
        box.setAttribute('stroke', '#000');
        box.setAttribute('stroke-width', '2');

        const checkmark = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        checkmark.setAttribute('d', 'M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z');
        checkmark.setAttribute('fill', '#000');
        checkmark.style.display = 'none';

        svg.appendChild(box);
        svg.appendChild(checkmark);

        return svg;
    }


    setupEventListeners() {
        const container = this.shadowRoot.querySelector('.svg-checkbox-container');
        const nativeCheckbox = this.shadowRoot.querySelector('input');
    
        // ✅ Handle normal left-click selection (ignore right-click)
        container.addEventListener('click', (e) => {
            if (e.button === 2) return; // ⛔ Ignore right-click for selection
            e.preventDefault();
            this.toggle();
        });
    
        // ✅ Handle mousedown - Start of Drag Selection (only left-click)
        container.addEventListener('mousedown', (e) => {
            if (e.button === 2) return; // ⛔ Ignore right-click
            e.preventDefault();
            this.toggle(); // First checkbox should toggle
    
            // Set this checkbox as the starting point of drag
            window.dragStartState = nativeCheckbox.checked;
            window.isDragging = true;
    
            // Mark as visited during this drag
            this._visitedDuringDrag = true;
    
            // Reset visited status for all checkboxes except this one
            document.querySelectorAll('svg-checkbox').forEach(checkbox => {
                if (checkbox !== this) {
                    checkbox._visitedDuringDrag = false;
                }
            });
        }, { passive: false });
    
        // ✅ Handle mouseover during drag selection (only left-click drag)
        container.addEventListener('mouseover', (e) => {
            if (window.isDragging && !this._visitedDuringDrag) {
                this.toggle(); // Toggle selection on hover
                this._visitedDuringDrag = true;
            }
        });
    
        // ✅ Handle touch-based drag selection (for mobile users)
        container.addEventListener('touchstart', (e) => {
            e.preventDefault();
            this.toggle();
    
            window.isDragging = true;
            this._visitedDuringDrag = true;
    
            document.querySelectorAll('svg-checkbox').forEach(checkbox => {
                if (checkbox !== this) {
                    checkbox._visitedDuringDrag = false;
                }
            });
        }, { passive: false });
    
        container.addEventListener('touchmove', (e) => {
            if (window.isDragging) {
                const touch = e.touches[0];
                const element = document.elementFromPoint(touch.clientX, touch.clientY);
    
                if (element) {
                    const checkboxElement = element.closest('svg-checkbox');
                    if (checkboxElement && !checkboxElement._visitedDuringDrag) {
                        checkboxElement.toggle();
                        checkboxElement._visitedDuringDrag = true;
                    }
                }
            }
        }, { passive: false });
    
        // ✅ Stop dragging when mouse or touch is released
        document.addEventListener('mouseup', () => {
            window.isDragging = false;
        });
    
        document.addEventListener('touchend', () => {
            window.isDragging = false;
        });
    }
    
    

    toggle() {
        this.checkedState = !this.checkedState;
        this.setAttribute("checked", this.checkedState ? "" : null);
        this.nativeCheckbox.checked = this.checkedState;
        
        // Update SVG color when toggled
        this.applyFlavorColor(this.shadowRoot.querySelector('.svg-container'));
    }

    applyFlavorColor(svgContainer) {
        const flavorName = this.getAttribute('value');
        if (!flavorName || !this.allFlavors) return;
    
        let matchedFlavor = this.allFlavors.find(f => f[0] === flavorName);
        if (!matchedFlavor) return;
    
        const coneColor = matchedFlavor[1];

        console.log(coneColor);
        
        let checkStyles = {true:{"filter": "none", "fill": coneColor, "transform": "scale(1.3)"}, 
        false:{"filter": "grayscale(100%)", "fill": "#D3D3D3", "transform": "scale(1)"}}

        console.log(checkStyles[this.checkedState]);

        Object.entries(checkStyles[this.checkedState]).forEach(([key, value]) => {
            svgContainer.style[key] = value;
        });
    }
    

    get checked() {
        return this.checkedState;
    }

    set checked(value) {
        this.checkedState = value;
        this.setAttribute("checked", value ? "" : null);
        this.nativeCheckbox.checked = value;
    }
}

customElements.define('svg-checkbox', SVGCheckbox);

function logSelectedFlavors() {
            const selectedFlavors = Array.from(document.querySelectorAll('svg-checkbox'))
                .filter(checkbox => checkbox.checked)
                .map(checkbox => checkbox.value);
           
            console.log('Selected Flavors:', selectedFlavors);
            alert('Selected Flavors: ' + selectedFlavors.join(', '));
        }
    </script>
</body>
</html>